/*Minified on Sat Jul 05 2014 23:57:07*/
window.Puls3={},Puls3.Views={},Puls3.Collections={},Puls3.Models={},Puls3.Routers={},window.app={},window.routers={},window.plugs={},window.views={},window.collections={},Puls3.Models.Article=Backbone.Model.extend({url:"/articles/"}),Puls3.Collections.Articles=Backbone.Collection.extend({model:Puls3.Models.Article,url:"/articles/",name:"articles"}),Puls3.Views.App=Backbone.View.extend({events:{"click .publicar":"showForm","submit form":"createArticle","click .logo":"navigateHome","click nav":"navigateTag"},initialize:function(a){this.$el=a},showForm:function(a){a.preventDefault(),this.$el.find("form").slideToggle()},createArticle:function(a){a.preventDefault();var b=$("input[name=titulo]").val()||"no asignado",c=$("input[name=autor]").val()||"no asignado",d=$("input[name=tag]").val()||"no asignado",e={title:b,image:"/imagenes/img4.jpg",user:c,tag:d,votes:0},f=new Puls3.Models.Article(e);f.save(),$("form").slideUp(function(){$("input[type=text]").val("")}),"root"!==window.app.state&&Backbone.history.navigate("/",{trigger:!0})},navigateHome:function(){Backbone.history.navigate("/",{trigger:!0})},navigateTag:function(a){a.preventDefault();var b=a.target.innerHTML;Backbone.history.navigate("/tag/"+b,{trigger:!0})}}),Puls3.Views.Article=Backbone.View.extend({events:{"click .acciones .votos .up":"upVote","click .acciones .votos .down":"downVote",click:"navigate"},tagName:"article",className:"post",initialize:function(a){var b=this;this.template=_.template($("#article-template").html()),this.extendedTemplate=_.template($("#article-extended-template").html()),this.model=a,this.model.on("change",function(){console.log("el modelo cambio"),b.renderVotes()}),window.routers.base.on("route:root",function(){b.$el.css("display",""),b.render()}),window.routers.base.on("route:articleSingle",function(){window.app.article===b.model.get("id")?b.extentedRender():b.$el.hide()}),window.routers.base.on("route:articlesTag",function(){window.app.tag===b.model.get("tag")?(b.$el.css("display",""),b.render()):b.$el.hide()})},extentedRender:function(){var a=this.model.toJSON(),b=this.extendedTemplate(a);this.$el.html(b),this.$el.css("width","100%")},render:function(){var a=this.model.toJSON(),b=this.template(a);this.$el.html(b),this.$el.css("width","")},renderVotes:function(){var a=this.model.get("votes");this.$el.find(".total").html(a)},upVote:function(a){a.preventDefault(),a.stopPropagation();var b=this.model.get("votes");this.model.set("votes",++b),this.model.save()},downVote:function(a){a.preventDefault(),a.stopPropagation();var b=this.model.get("votes");this.model.set("votes",--b),this.model.save()},navigate:function(){Backbone.history.navigate("/article/"+this.model.get("id"),{trigger:!0})}}),Puls3.Routers.Base=Backbone.Router.extend({routes:{"":"root","article/:id":"articleSingle","tag/:nombre":"articlesTag"},root:function(){console.log("Estamos en el root"),window.app.state="root",window.app.article=null,window.app.tag=null},articleSingle:function(a){console.log("Estamos en articleSingle"),window.app.state="articleSingle",window.app.article=a,window.app.tag=null},articlesTag:function(a){window.app.state="articlesTag",window.app.article=null,window.app.tag=a}}),$(document).ready(function(){console.log("main.js loaded"),window.collections.articles=new Puls3.Collections.Articles;var a=window.collections.articles.fetch();window.collections.articles.on("add",function(a){console.log("nuevo modelo agregado a la coleccion articles"),console.log(a.toJSON());var b=new Puls3.Views.Article(a);b.render(),b.$el.prependTo(".posts").css("opacity","0.1").css("margin-top","-150px").animate({"margin-top":"0",opacity:"1"},500)}),window.views.app=new Puls3.Views.App($("body")),window.ponyExpress=new PonyExpress({io:window.location.origin}),window.ponyExpress.bind("connect",function(){window.plugs.article=new PonyExpress.BackbonePlug({collection:window.collections.articles})}),window.routers.base=new Puls3.Routers.Base,a.done(function(){Backbone.history.start({root:"/",pushState:!0})})});